/**
 * Tuzame Test App
 * @namespace tuzameApp
 */

(function(angular){

    'use strict';
    angular
        .module('tuzameApp', [
            'ngResource',
            'ngSanitize'
        ]);

})(angular);
/**
 * NYT API Factory
 * @namespace Factories
 * @memberof tuzameApp
 */

(function(angular){
    'use strict';

    var NYTIMES_URL = 'http://api.nytimes.com/svc/news/v3/content/all/',
        NYTIMES_API_KEY = '29707f6e4e029b2a8d24924ef73e30fc:5:74629606';

    angular.module('tuzameApp')
        .factory ('NYTimes', NYTimesFactory);

    /**
     * @function NYTimes
     * @desc Gets the news from NYT API
     * @memberOf Factories
     * @returns {Object}
     */

    NYTimesFactory.$inject = ['$resource'];

    function NYTimesFactory($resource){

        return $resource(
            NYTIMES_URL ,
            { callback: 'JSON_CALLBACK' },
            {
                'getNews': {
                    url: NYTIMES_URL + ':section//.json',
                    section : '@section',
                    method: 'GET',
                    params : {
                        'api-key' : NYTIMES_API_KEY
                    }
                }
            }
        );
    }

})(angular);

/**
 * News Factory
 * @namespace Factories
 * @memberof tuzameApp
 */

(function(angular){
    'use strict';

    var NEWS_URL_BASE = 'http://test-be.tsuru2.tuzame.com/api';

    angular.module('tuzameApp')
        .factory ('News', newsFactory);

    /**
     * @function News
     * @desc Gets the news from Tuzame API
     * @memberOf Factories
     * @returns {Object}
     */

    newsFactory.$inject = ['$resource'];

    function newsFactory($resource){

        return $resource(
            NEWS_URL_BASE + '/news/:id',
            { 'id': '@id' },
            {
                'getNews': {
                    isArray: true,
                    url: NEWS_URL_BASE + '/news',
                    method: 'GET'
                }
            }
        );
    }

})(angular);

(function(angular){
    'use strict';

    angular
        .module('tuzameApp')
        .directive('newsWidget', newsWidget);

    newsWidget.$inject = ['NYTimes','$animate'];

    function newsWidget(NYTimes,$animate) {

        var directive = {
            link: link,
            scope: true,
            templateUrl: 'views/news/news.html',
            restrict: 'EA'
        };

        return directive;

        function link(scope, element, attrs){

            scope.ready = false;
            NYTimes
                .getNews({section:'world'})
                .$promise
                .then(function(data){
                    console.log(data.results);

                    scope.data = data.results;
                    scope.ready = true;
                    scope.showNews();

                });

            scope.index = 0;
            scope.current = {};

            scope.showNews = function(direction){

                var widget = angular.element(document.querySelector('.tuzame-news__widget'));

                $animate.removeClass(widget, 'animated').then(function() {
                    widget.addClass('animated');
                });

                if (scope.index>=0 && scope.index < scope.data.length && direction) {
                    (direction == 'next') ? scope.index++ : scope.index-- ;
                }

                scope.current = scope.data[scope.index];
            };

        }
    }


})(angular);
(function(){
    'use strict';

    angular.module('tuzameApp')
        .run(testCtrl);

    testCtrl.$inject = ['News', 'NYTimes'];

    function testCtrl(News, NYTimes){
        var vm = this;

        //News
        //  .getNews()
        //  .$promise
        //  .then(function(data){
        //    console.log(data);
        //    angular.extend(vm,data);
        //  });

        //NYTimes
        //    .getNews({section:'world'})
        //    .$promise
        //    .then(function(data){
        //        //console.log(JSON.parse(data));
        //        console.log(data.results);
        //    });
    }


})();

(function(angular){
    'use strict';

    angular
        .module('tuzameApp')
        .controller('newsController', newsController);

    newsController.$inject = ['News', 'NYTimes','$timeout'];

    function newsController(News, NYTimes, $timeout ) {

    }


})(angular);